<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Master Editor | The CoCo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #F0F2F5; }
    .tab-btn { padding: 15px 0; font-weight: 700; color: #94A3B8; border-bottom: 4px solid transparent; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
    .tab-active { color: #0F172A; border-bottom-color: #0F172A; }
    .card { background: #fff; padding: 2rem; border-radius: 2.5rem; border: 1px solid rgba(0,0,0,0.03); }
    .label { font-size: 0.65rem; font-weight: 700; color: #64748B; text-transform: uppercase; margin-bottom: 0.5rem; display: block; }
    .input { width: 100%; border: 1px solid #E2E8F0; border-radius: 1rem; padding: 0.9rem; outline: none; font-size: 0.9rem; font-weight: 500; }
  </style>
</head>
<body class="p-6 md:p-12 italic">
  <div class="max-w-5xl mx-auto">
    <div class="bg-slate-900 rounded-[3rem] p-10 text-white flex justify-between items-center mb-8 shadow-2xl">
      <div><p class="text-blue-400 font-bold uppercase text-[10px] tracking-widest mb-2">Master Database Editor</p><h1 id="hpId" class="text-4xl md:text-5xl font-bold tracking-tighter">HP00-XXXX</h1></div>
      <button onclick="history.back()" class="bg-white/10 p-5 rounded-2xl hover:bg-white/20">‚úï</button>
    </div>
    <div class="flex gap-8 mb-8 border-b border-slate-200">
      <button id="bPhoto" onclick="setTab('photo')" class="tab-btn tab-active">Cover & Gallery</button>
      <button id="bData" onclick="setTab('data')" class="tab-btn">Property Data</button>
    </div>
    <div id="tPhoto" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="card"><span class="label">Cover Image</span><div id="tPrev" class="h-56 bg-slate-50 rounded-3xl border-2 border-dashed flex items-center justify-center mb-4 overflow-hidden">üñºÔ∏è</div><button class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold uppercase text-[10px]">Upload Cover</button></div>
      <div class="card"><span class="label">Gallery Album</span><div class="h-56 bg-slate-50 rounded-3xl border-2 border-dashed flex items-center justify-center mb-4 overflow-hidden text-3xl">üóÇÔ∏è</div><button class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold uppercase text-[10px]">Add Gallery Photos</button></div>
    </div>
    <div id="tData" class="hidden card grid grid-cols-1 md:grid-cols-3 gap-6">
      <div><span class="label">Plot</span><input id="Plot" class="input"></div>
      <div><span class="label">Price (THB)</span><input id="Sale_Price" class="input font-bold text-blue-600"></div>
      <div><span class="label">Status</span><select id="Status" class="input font-bold"><option value="Available">Available</option><option value="Sold">Sold</option></select></div>
      <div class="col-span-full"><span class="label">Description</span><textarea id="Description" rows="4" class="input"></textarea></div>
    </div>
    <button onclick="save()" id="sBtn" class="w-full mt-10 py-8 bg-slate-900 text-white rounded-[3rem] font-bold uppercase tracking-[0.5em] shadow-2xl hover:bg-blue-600 transition-all active:scale-95">Update Master Database</button>
  </div>
  <script>
    const API = "https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec";
    const hpId = new URLSearchParams(location.search).get('id');
    function setTab(t) {
      document.getElementById('tPhoto').classList.toggle('hidden', t==='data'); document.getElementById('tData').classList.toggle('hidden', t==='photo');
      document.getElementById('bPhoto').classList.toggle('tab-active', t==='photo'); document.getElementById('bData').classList.toggle('tab-active', t==='data');
    }
    async function load() {
      document.getElementById('hpId').innerText = hpId;
      const res = await fetch(`${API}?mode=getUnitDetail&hpId=${hpId}`);
      const u = await res.json();
      document.getElementById('Plot').value = u.Plot || "";
      document.getElementById('Sale_Price').value = u.Sale_Price || "";
      document.getElementById('Description').value = u.Description || "";
      if(u.Thumbnail_Image) document.getElementById('tPrev').innerHTML = `<img src="${u.Thumbnail_Image}" class="w-full h-full object-cover">`;
    }
    async function save() {
      const b = document.getElementById('sBtn'); b.innerText = "UPDATING DATABASE...";
      const payload = { mode: "updateUnit", HP_ID: hpId, Plot: document.getElementById('Plot').value, Sale_Price: document.getElementById('Sale_Price').value, Description: document.getElementById('Description').value };
      await fetch(API, { method: "POST", body: JSON.stringify(payload) });
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); location.href='dashboard.html';
    }
    load();
  </script>
</body>
</html>
